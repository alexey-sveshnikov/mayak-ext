(()=>{"use strict";var e,t={8957:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=i(o(7294)),c=a(o(2788)),l=o(1225),s=o(470);t.default=function(){const[e,t]=(0,u.useState)(!1),o=(0,u.useRef)(null),[n,r]=(0,u.useState)(!1);var i,a;i=()=>r(!1),(0,u.useEffect)((()=>{setTimeout((()=>{rrToUtkAdapter.onCartItems(i)}),1e3)}),[]),a=[e],(0,u.useEffect)((()=>{const o=o=>{(e=>"Escape"==e.key)(o)&&t(!e)};return document.addEventListener("keyup",o),()=>{document.removeEventListener("keyup",o)}}),a);const c=(0,u.useCallback)((()=>{if(null==o.current)return;const e=(0,l.extractData)(o.current);0!=e.length?(console.log("adding items",e),r(!0),s.utkonosAPI.saveCart(e).then((()=>{window.location.reload()})).catch((e=>{console.log("failed to save",e),alert(`Не удалось сохранить: ${e}`),window.location.reload()}))):console.log("no data extracted")}),[]);return u.default.createElement(u.default.StrictMode,null,e&&u.default.createElement(d,null,u.default.createElement(f,{contentEditable:!0,ref:o}),u.default.createElement(h,{onClick:c,disabled:n},n&&"Сохраняем...",!n&&"Добавить")),u.default.createElement(p,{onClick:()=>t(!e)}))};const d=c.default.div`
  position: fixed;
  width: 400px;
  height: 80vh;
  top: calc(50% - 40vh);
  right: 5px;
  background: #ffd9d9;
  z-index: 1000;
  border: 1px solid #555;
  border-radius: 7px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
`,f=c.default.div`
  height: 100%;
  width: 100%;
  border-radius: 7px;
  background: white;
  overflow: scroll;
  
  padding: 5px 10px;
`,h=c.default.button`
  margin: 5px;
  border: 1px solid black;
  border-radius: 3px;
`,p=c.default.div`
  position: fixed;
  height: 73px;
  width: 36px;
  top: 0;
  right: 0;
  z-index: 1000;
  background: url(https://mayak.help/wp-content/themes/mayak/img/logo.png);
  transform: scale(0.8);
  -webkit-transform-origin-x: right;
  -webkit-transform-origin-y: top;
`},5311:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(7294)),i=n(o(3935)),a=n(o(8957));console.log("[utkonos-ext] initializing");const u=document.createElement("div");document.body.appendChild(u),i.default.render(r.default.createElement(a.default,null),u)},923:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractFromTable=void 0;const n=o(9385),r=o(8446),i=(o(4788),o(6026));t.extractFromTable=function(e){const t=function(e){const t=(0,n.doXpath)(".//tr",e),o=[];for(const e of t){const t=[];for(const o of e.childNodes){const e=document.evaluate(".//a",o,null,XPathResult.ANY_TYPE).iterateNext();if(null!==e){const o=e instanceof HTMLElement?e.getAttribute("href"):e.textContent;t.push(o||"")}else t.push(o.textContent||"")}o.push(t)}return o}(e);if(0==t.length)return[];let o=[],a=[];0==t[0].filter((e=>!isNaN(parseFloat(e.trim())))).length&&t.shift(),console.log("table data"),console.table(t);for(let e=0;e<t[0].length;e++){const n=t.map((t=>t[e]));if(-1!=t[0][e].indexOf("utkonos.ru")){console.log(`column ${e} seems to contain links`),o=n;continue}const u=n.map((e=>parseFloat(e)));if(void 0!==u.find(isNaN)){console.log(`column ${e} is not all numbers`);continue}if(r(u,i(1,t.length+1))){console.log(`column ${e} looks like a row numbers`);continue}const c=u.reduce(((e,t)=>e+t),0)/n.length,l=u.filter((e=>Math.round(e)==e)).length/n.length;c<15&&l>.5?(console.log(`column ${e} seems to have a quantities`),a=u):console.log(`column ${e} ignored. Average value: ${c}, rate of rounded values: ${l})`)}const u=o.map((e=>{var t;return null===(t=e.match(/utkonos\.ru\/item\/(\d+)/))||void 0===t?void 0:t[1]})).map((e=>parseInt(e||""))).filter(Boolean);return u.length==a.length?u.map(((e,t)=>({id:e,quantity:a[t]}))):u.map((e=>({id:e,quantity:1})))}},3187:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractFromUnstructuredText=void 0;const n=o(9385);t.extractFromUnstructuredText=function(e){const t=[],o=(0,n.doXpath)(".//a",e);for(const e of o)if(e instanceof HTMLElement){const o=e.getAttribute("href");o&&t.push(o)}const r=t.join("\n")+e.textContent,i=[],a=new Set;for(const e of r.matchAll(/https:\/\/www\.utkonos\.ru\/item\/(\d+)/g)){const t=e[1];a.has(t)||(a.add(t),i.push({id:parseInt(t),quantity:1}))}return i}},1225:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractData=void 0;const n=o(923),r=o(3187);t.extractData=function(e){if(1==document.evaluate("count(.//table)",e,null,XPathResult.NUMBER_TYPE).numberValue){const t=(0,n.extractFromTable)(e);if(t.length>0)return t}return(0,r.extractFromUnstructuredText)(e)}},9620:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=void 0,t.uuidv4=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}},9385:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.doXpath=void 0,t.doXpath=function(e,t,o=XPathResult.ORDERED_NODE_ITERATOR_TYPE){const n=[],r=document.evaluate(e,t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE);let i=r.iterateNext();for(;i;)i instanceof HTMLElement&&n.push(i),i=r.iterateNext();return n}},470:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},a=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,u)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.utkonosAPI=t.UtkonosAPIException=void 0;const u=i(o(351)),c=o(9620);class l extends Error{constructor(e){super(e),this.name="UtkonosAPIException"}}t.UtkonosAPIException=l,t.utkonosAPI=new class{saveCart(e){return a(this,void 0,void 0,(function*(){const t=[],o=[];for(const n of e)t.push(n.id.toString()),o.push(n.quantity);const n={GoodsItemId:t,Count:o,UseDelta:0,Return:{Cart:"0",CartItemList:"0",TotalCost:"0"}};return this.makeRequest("cartItemMultiAdd",n)}))}goodsItemSearchByid(e){return a(this,void 0,void 0,(function*(){const t={Id:e.toString(),Return:{BrandInfo:1}};return this.makeRequest("goodsItemSearchByid",t)}))}makeRequest(e,t){return a(this,void 0,void 0,(function*(){const o=JSON.parse(localStorage.getItem("device_data")||"{}"),n=yield u.get("Utk_SessionToken"),r={Head:{DeviceId:o.device_id,Domain:"www.utkonos.ru",RequestId:(0,c.uuidv4)().replaceAll(/-/g,""),MarketingPartnerKey:"mp-cc3c743ffd17487a9021d11129548218",Version:"utkonos-ext",Client:"utkonos-ext",Method:e,Store:"utk",SessionToken:n},Body:t};console.log("sending request to method",e,r);const i=new FormData;i.append("request",JSON.stringify(r));const a=yield fetch(`https://www.utkonos.ru/api/v1/${e}`,{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9,ru;q=0.8","cache-control":"no-cache",pragma:"no-cache","sec-ch-ua":'"Chromium";v="106", "Google Chrome";v="106", "Not;A=Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:"https://www.utkonos.ru/",referrerPolicy:"no-referrer-when-downgrade",body:i,method:"POST",mode:"cors",credentials:"include"});if(console.log(a),!a.ok)throw new l(a.statusText);return a}))}}}},o={};function n(e){var r=o[e];if(void 0!==r)return r.exports;var i=o[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=t,e=[],n.O=(t,o,r,i)=>{if(!o){var a=1/0;for(s=0;s<e.length;s++){for(var[o,r,i]=e[s],u=!0,c=0;c<o.length;c++)(!1&i||a>=i)&&Object.keys(n.O).every((e=>n.O[e](o[c])))?o.splice(c--,1):(u=!1,i<a&&(a=i));if(u){e.splice(s--,1);var l=r();void 0!==l&&(t=l)}}return t}i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[o,r,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={575:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var r,i,[a,u,c]=o,l=0;if(a.some((t=>0!==e[t]))){for(r in u)n.o(u,r)&&(n.m[r]=u[r]);if(c)var s=c(n)}for(t&&t(o);l<a.length;l++)i=a[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(s)},o=self.webpackChunkutkonos_ext=self.webpackChunkutkonos_ext||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),n.nc=void 0;var r=n.O(void 0,[736],(()=>n(5311)));r=n.O(r)})();