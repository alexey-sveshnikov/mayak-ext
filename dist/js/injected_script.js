(()=>{"use strict";var e,t={8957:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(n(7294)),u=i(n(677)),c=n(1235),s=n(1225);t.default=function(){const[e,t]=(0,l.useState)(!1),n=(0,l.useRef)(null);(0,l.useEffect)((()=>{const n=n=>{("Escape"==n.key||("k"==n.key||"к"==n.key)&&n.ctrlKey)&&t(!e)};return document.addEventListener("keyup",n),()=>{document.removeEventListener("keyup",n)}}),[e]);const o=(0,l.useCallback)((()=>{if(null==n.current)return;const e=(0,s.extractData)(n.current);0!=e.length?(console.log("adding items",e),(0,c.saveCartItems)(e).then((()=>{rrToUtkAdapter.modifyItemAtCart(e[0])}))):console.log("no data extracted")}),[]);return l.default.createElement(l.default.StrictMode,null,e&&l.default.createElement(d,null,l.default.createElement(f,{contentEditable:!0,ref:n}),l.default.createElement("button",{onClick:o},"Добавить")),l.default.createElement(h,{onClick:()=>t(!e)}))};const d=u.default.div`
  position: fixed;
  width: 400px;
  height: 80vh;
  top: calc(50% - 40vh);
  right: 0;
  background: #ffd9d9;
  z-index: 1000;
  border: 1px solid #555;
  border-radius: 7px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
`,f=u.default.div`
  height: 100%;
  width: 100%;
  border-radius: 7px;
  background: white;
  overflow: scroll;
`,h=u.default.div`
  position: fixed;
  height: 73px;
  width: 36px;
  top: 0;
  right: 0;
  z-index: 1000;
  background: url(https://mayak.help/wp-content/themes/mayak/img/logo.png);
  transform: scale(0.8);
  -webkit-transform-origin-x: right;
  -webkit-transform-origin-y: top;
`},5311:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(7294)),a=o(n(3935)),i=o(n(8957));console.log("[utkonos-ext] initializing");const l=document.createElement("div");document.body.appendChild(l),a.default.render(r.default.createElement(i.default,null),l)},923:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractFromTable=void 0;const o=n(6587),r=n(8446),a=(n(4788),n(6026));t.extractFromTable=function(e){const t=function(e){const t=(0,o.doXpath)(".//tr",e),n=[];for(const e of t){const t=[];for(const n of e.childNodes){const e=document.evaluate(".//a",n,null,XPathResult.ANY_TYPE).iterateNext();if(null!==e){const n=e instanceof HTMLElement?e.getAttribute("href"):e.textContent;t.push(n||"")}else t.push(n.textContent||"")}n.push(t)}return n}(e);if(0==t.length)return[];let n=[],i=[];0==t[0].filter((e=>!isNaN(parseFloat(e.trim())))).length&&t.shift(),console.log("table data"),console.table(t);for(let e=0;e<t[0].length;e++){const o=t.map((t=>t[e]));if(-1!=t[0][e].indexOf("utkonos.ru")){console.log(`column ${e} seems to contain links`),n=o;continue}const l=o.map((e=>parseFloat(e)));if(void 0!==l.find(isNaN)){console.log(`column ${e} is not all numbers`);continue}if(r(l,a(1,t.length+1))){console.log(`column ${e} looks like a row numbers`);continue}const u=l.reduce(((e,t)=>e+t),0)/o.length,c=l.filter((e=>Math.round(e)==e)).length/o.length;u<15&&c>.5?(console.log(`column ${e} seems to have a quantities`),i=l):console.log(`column ${e} ignored. Average value: ${u}, rate of rounded values: ${c})`)}const l=n.map((e=>{var t;return null===(t=e.match(/utkonos\.ru\/item\/(\d+)/))||void 0===t?void 0:t[1]})).map((e=>parseInt(e||""))).filter(Boolean);return l.length==i.length?l.map(((e,t)=>({id:e,quantity:i[t]}))):l.map((e=>({id:e,quantity:1})))}},3187:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractFromUnstructuredText=void 0;const o=n(6587);t.extractFromUnstructuredText=function(e){const t=[],n=(0,o.doXpath)(".//a",e);for(const e of n)if(e instanceof HTMLElement){const n=e.getAttribute("href");n&&t.push(n)}const r=t.join("\n")+e.textContent,a=[],i=new Set;for(const e of r.matchAll(/https:\/\/www\.utkonos\.ru\/item\/(\d+)/g)){const t=e[1];i.has(t)||(i.add(t),a.push({id:parseInt(t),quantity:1}))}return a}},6587:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.doXpath=void 0,t.doXpath=function(e,t,n=XPathResult.ORDERED_NODE_ITERATOR_TYPE){const o=[],r=document.evaluate(".//tr",t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE);let a=r.iterateNext();for(;a;)a instanceof HTMLElement&&o.push(a),a=r.iterateNext();return o}},1225:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractData=void 0;const o=n(923),r=n(3187);t.extractData=function(e){if(1==document.evaluate("count(.//table)",e,null,XPathResult.NUMBER_TYPE).numberValue){const t=(0,o.extractFromTable)(e);if(t.length>0)return t}return(0,r.extractFromUnstructuredText)(e)}},1235:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},i=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function l(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.saveCartItems=void 0;const l=a(n(351));t.saveCartItems=function(e){return i(this,void 0,void 0,(function*(){const t=JSON.parse(localStorage.getItem("device_data")||"{}"),n=yield l.get("Utk_SessionToken"),o=[],r=[];for(const t of e)o.push(t.id.toString()),r.push(t.quantity);const a={Head:{DeviceId:t.device_id,Domain:"www.utkonos.ru",RequestId:([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))).replaceAll(/-/g,""),MarketingPartnerKey:"mp-cc3c743ffd17487a9021d11129548218",Version:"utkonos-ext",Client:"utkonos-ext",Method:"cartItemMultiAdd",Store:"utk",SessionToken:n},Body:{GoodsItemId:o,Count:r,UseDelta:0,Return:{Cart:"0",CartItemList:"0",TotalCost:"0"}}};console.log("sending request",a);const i=new FormData;i.append("request",JSON.stringify(a));const u=yield fetch("https://www.utkonos.ru/api/v1/cartItemMultiAdd",{headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9,ru;q=0.8","cache-control":"no-cache",pragma:"no-cache","sec-ch-ua":'"Chromium";v="106", "Google Chrome";v="106", "Not;A=Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrer:"https://www.utkonos.ru/",referrerPolicy:"no-referrer-when-downgrade",body:i,method:"POST",mode:"cors",credentials:"include"});console.log(u)}))}}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=t,e=[],o.O=(t,n,r,a)=>{if(!n){var i=1/0;for(s=0;s<e.length;s++){for(var[n,r,a]=e[s],l=!0,u=0;u<n.length;u++)(!1&a||i>=a)&&Object.keys(o.O).every((e=>o.O[e](n[u])))?n.splice(u--,1):(l=!1,a<i&&(i=a));if(l){e.splice(s--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var s=e.length;s>0&&e[s-1][2]>a;s--)e[s]=e[s-1];e[s]=[n,r,a]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=575,(()=>{var e={575:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[i,l,u]=n,c=0;if(i.some((t=>0!==e[t]))){for(r in l)o.o(l,r)&&(o.m[r]=l[r]);if(u)var s=u(o)}for(t&&t(n);c<i.length;c++)a=i[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(s)},n=self.webpackChunkutkonos_ext=self.webpackChunkutkonos_ext||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.nc=void 0;var r=o.O(void 0,[736],(()=>o(5311)));r=o.O(r)})();